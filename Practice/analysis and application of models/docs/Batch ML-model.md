# Пакетные модели ML

Усовик С.В. (usovik@mirea.ru)

## Содержание

1. Требования
2. Выделение признаков и построение модели
3. Выполнение модели
4. Представление результатов
5. Рекомендации


Пакетный режим ML-моделей предполагает отложенное (по расписанию) выполнение моделей и получение результатов. Для этого,как правило, отдельно сериализованная модель выполняется в удобное время на кластере Spark на новом поступившем пакетк данных. 

## Требования

Для работы необходима установка следующего ПО:
- Python 3+
- Jupyter
- Apache Spark


## Выделение признаков и построение модели

В [notebook](../projects/batch-ML-model/malicious_url.ipynb) приведен пример выделения признаков и построения модели на сырых [данных](../data/malicious_phish.csv) классификации вредоносных ссылок. После выполнения процедуры выбора подходящих параметров модели

```
from sklearn.metrics import classification_report

print(classification_report(y_test, pipe.predict(X_test)))

              precision    recall  f1-score   support

           0       0.96      0.99      0.97      1312
           1       0.97      0.92      0.95       688

    accuracy                           0.96      2000
   macro avg       0.97      0.96      0.96      2000
weighted avg       0.97      0.96      0.96      2000

```

необходимо сериализовать (заархивировать) модель и сохранить в указанном месте: 

```
import pickle

with open("model.pkl", "wb") as f:
    pickle.dump(pipe, f)
```


## Выполнение модели

Модель выполняется при помощи Apache Spark. Для этого необходимо создать Spark-сессию и выполняем обработку новой порции данных при помощи сохраненной в предыдущем разделе модели. Результат сохраняем в необходимом нам месте для дальнейшего использования.

Описанный код содержится в файлах [app.py](../projects/batch-ML-model/app.py) и [misc.py](../projects/batch-ML-model/misc.py).


## Представление результатов

Представление результатов производится при помощи Apache Spark над файлом результата обработки на предыдущем шаге. При помощи методов SparkSQL можно представить результат в виде витрины данных. Демонстрирующий это notebook представлен [здесь](../projects/batch-ML-model/show_predictions.ipynb).  

## Рекомендации